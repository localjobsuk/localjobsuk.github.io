<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Job Details ‚Äì LocalJobsUK</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    .box {
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .locked {
      background: #f5f5f5;
      color: #777;
      text-align: center;
      padding: 15px;
      border-radius: 8px;
    }
    .unlock {
      background: #203a43;
      color: white;
      padding: 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>

<body>

<h2 id="title">Loading‚Ä¶</h2>

<div class="box">
  <p><strong>Location:</strong> <span id="location"></span></p>
  <p id="description"></p>
</div>

<div class="box">
  <h3>Photos</h3>
  <div id="photos">No photos uploaded</div>
</div>

<div class="box" id="contactBox">
  <div class="locked">
    üîí Contact details locked<br><br>
    Unlock this job to contact the owner
  </div>
</div>

<br>
<a href="worker.html">‚Üê Back to jobs</a>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore,
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import {
    getAuth,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDooNTj5INtuTTJqmgrA-kOA_i_JFDdQyw",
    authDomain: "localjobsuk-fcaba.firebaseapp.com",
    projectId: "localjobsuk-fcaba",
    storageBucket: "localjobsuk-fcaba.firebasestorage.app",
    messagingSenderId: "340038751338",
    appId: "1:340038751338:web:05cca93a73a61de10d2613"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const jobId = new URLSearchParams(window.location.search).get("id");

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    const jobRef = doc(db, "jobs", jobId);
    const jobSnap = await getDoc(jobRef);
    const job = jobSnap.data();

    document.getElementById("title").innerText = job.title;
    document.getElementById("location").innerText = job.location;
    document.getElementById("description").innerText = job.description;

    // üì∏ PHOTOS (VISIBLE TO ALL)
    if (job.photos && job.photos.length > 0) {
      document.getElementById("photos").innerHTML =
        job.photos.map(url => `<img src="${url}" style="max-width:100%;margin-bottom:10px;">`).join("");
    }

    // üîê CHECK IF USER UNLOCKED
    const unlockedUsers = job.unlockedUsers || [];

    if (unlockedUsers.includes(user.uid)) {
      document.getElementById("contactBox").innerHTML = `
        <div class="box">
          <h3>Contact details</h3>
          <p><strong>Name:</strong> ${job.ownerName}</p>
          <p><strong>Email:</strong> ${job.ownerEmail}</p>
          <p><strong>Phone:</strong> ${job.ownerPhone}</p>
        </div>
      `;
    }
  });
</script>

</body>
</html>
